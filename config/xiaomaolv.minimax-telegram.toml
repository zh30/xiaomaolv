[app]
bind = "0.0.0.0:8080"
default_provider = "minimax"
max_history = 20
concurrency_limit = 128

[providers.minimax]
kind = "openai-compatible"
base_url = "https://api.minimaxi.com/v1"
api_key = "${MINIMAX_API_KEY}"
model = "${MINIMAX_MODEL:-MiniMax-M2.5-highspeed}"
timeout_secs = 45
max_retries = 2

[channels.http]
enabled = true

[channels.telegram]
enabled = true
bot_token = "${TELEGRAM_BOT_TOKEN}"
bot_username = "${TELEGRAM_BOT_USERNAME:-}"
polling_timeout_secs = 30
streaming_enabled = true
streaming_edit_interval_ms = 900
streaming_prefer_draft = true
startup_online_enabled = true
startup_online_text = "${TELEGRAM_STARTUP_ONLINE_TEXT:-online}"
commands_enabled = true
commands_auto_register = true
commands_private_only = true
admin_user_ids = "${TELEGRAM_ADMIN_USER_IDS:-}"
# Group trigger policy:
# - strict: only @mention or reply-to-bot can trigger response
# - smart: contextual rule-based trigger, with observe-only fallback
group_trigger_mode = "${TELEGRAM_GROUP_TRIGGER_MODE:-smart}"
group_followup_window_secs = 180
group_cooldown_secs = 20
group_rule_min_score = 70
group_llm_gate_enabled = false
# Scheduler:
scheduler_enabled = true
scheduler_tick_secs = 2
scheduler_batch_size = 8
scheduler_lease_secs = 30
scheduler_default_timezone = "${TELEGRAM_SCHEDULER_DEFAULT_TIMEZONE:-Asia/Shanghai}"
scheduler_nl_enabled = true
# When true, bot sends draft then waits for "确认"/"取消"
scheduler_nl_min_confidence = 0.78
scheduler_require_confirm = true
scheduler_max_jobs_per_owner = 64

[memory]
backend = "sqlite-only" # sqlite-only | hybrid-sqlite-zvec
max_recent_turns = 0 # 0 means fallback to app.max_history
max_semantic_memories = 8
semantic_lookback_days = 90
context_window_tokens = 200000
context_reserved_tokens = 8192
hybrid_keyword_enabled = true
hybrid_keyword_topk = 8
hybrid_keyword_candidate_limit = 256
hybrid_memory_snippet_max_chars = 420
hybrid_min_score = 0.18
context_memory_budget_ratio = 35
context_min_recent_messages = 8

[memory.zvec]
endpoint = "${ZVEC_SIDECAR_ENDPOINT}"
collection = "agent_memory_v1"
query_topk = 20
request_timeout_secs = 3
upsert_path = "/v1/memory/upsert"
query_path = "/v1/memory/query"
# auth_bearer_token = "${ZVEC_SIDECAR_TOKEN}"

[agent]
mcp_enabled = true
mcp_max_iterations = 4
mcp_max_tool_result_chars = 4000
skills_enabled = true
skills_max_selected = 3
skills_max_prompt_chars = 8000
skills_match_min_score = 0.45
skills_llm_rerank_enabled = false
