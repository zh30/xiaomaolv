[app]
bind = "0.0.0.0:8080"
default_provider = "openai"
locale = "${XIAOMAOLV_LOCALE:-en-US}"
max_history = 16
concurrency_limit = 128

[providers.openai]
kind = "openai-compatible"
base_url = "https://api.openai.com/v1"
api_key = "your-openai-api-key"
model = "gpt-4o-mini"
timeout_secs = 30
max_retries = 2

[channels.http]
enabled = true
# Required for GET /v1/code-mode/diag (Bearer token)
# diag_bearer_token = "${HTTP_DIAG_BEARER_TOKEN}"
diag_rate_limit_per_minute = 120

[channels.telegram]
enabled = false
bot_token = "your-telegram-bot-token"
# Optional: your bot username without '@', used for group @mention filtering
# bot_username = "your_bot_username"
polling_timeout_secs = 30
streaming_enabled = true
streaming_edit_interval_ms = 900
streaming_prefer_draft = true
startup_online_enabled = false
startup_online_text = "online"
commands_enabled = true
commands_auto_register = true
commands_private_only = true
admin_user_ids = "${TELEGRAM_ADMIN_USER_IDS:-}"
# Group trigger policy:
# - strict: only @mention or reply-to-bot can trigger response
# - smart: rule-based contextual trigger (with cooldown + observe-only path)
group_trigger_mode = "${TELEGRAM_GROUP_TRIGGER_MODE:-smart}"
group_followup_window_secs = 180
group_cooldown_secs = 20
group_rule_min_score = 70
# Reserved for future gray-zone LLM arbitration
group_llm_gate_enabled = false
# Scheduler:
scheduler_enabled = true
scheduler_tick_secs = 2
scheduler_batch_size = 8
scheduler_lease_secs = 30
scheduler_default_timezone = "${TELEGRAM_SCHEDULER_DEFAULT_TIMEZONE:-Asia/Shanghai}"
scheduler_nl_enabled = true
# When true, bot sends draft then waits for "确认"/"取消"
scheduler_nl_min_confidence = 0.78
scheduler_require_confirm = true
scheduler_max_jobs_per_owner = 64

[memory]
backend = "sqlite-only" # sqlite-only | hybrid-sqlite-zvec
max_recent_turns = 0 # 0 means fallback to app.max_history
max_semantic_memories = 8
semantic_lookback_days = 90
context_window_tokens = 200000
context_reserved_tokens = 8192
hybrid_keyword_enabled = true
hybrid_keyword_topk = 8
hybrid_keyword_candidate_limit = 256
hybrid_memory_snippet_max_chars = 420
hybrid_min_score = 0.18
context_memory_budget_ratio = 35
context_min_recent_messages = 8

[memory.zvec]
endpoint = "${ZVEC_SIDECAR_ENDPOINT}"
collection = "agent_memory_v1"
query_topk = 20
request_timeout_secs = 3
upsert_path = "/v1/memory/upsert"
query_path = "/v1/memory/query"
# auth_bearer_token = "${ZVEC_SIDECAR_TOKEN}"

[agent]
mcp_enabled = true
mcp_max_iterations = 4
mcp_max_tool_result_chars = 4000
skills_enabled = true
skills_max_selected = 3
skills_max_prompt_chars = 8000
skills_match_min_score = 0.45
skills_llm_rerank_enabled = false

[agent.code_mode]
enabled = false
shadow_mode = true
max_calls = 6
max_parallel = 2
max_runtime_ms = 2500
max_call_timeout_ms = 1200
timeout_warn_ratio = 0.4
timeout_auto_shadow_enabled = false
timeout_auto_shadow_probe_every = 5
timeout_auto_shadow_streak = 3
max_result_chars = 12000
execution_mode = "local" # local | subprocess
subprocess_timeout_secs = 8
allow_network = false
allow_filesystem = false
allow_env = false

# Custom provider/channel plugin example (requires registering factories in your startup code)
# [providers.myprovider]
# kind = "my-provider-kind"
# [providers.myprovider.options]
# endpoint = "https://api.example.com"
# token = "secret"
#
# [channels.plugins.discord]
# enabled = true
# kind = "discord-webhook"
# [channels.plugins.discord.settings]
# signing_secret = "xxx"
